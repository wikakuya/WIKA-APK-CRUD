<!DOCTYPE html>
<html>
<head>
  <title>CRUD Mahasiswa (data.txt)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
  <div class="row">
    <div class="col-md-6">
      <h3 class="mb-4">Tambah Data Mahasiswa</h3>
      <form id="formData" class="card p-4 shadow-sm bg-white">
        <div class="mb-3">
          <label class="form-label">NIM</label>
          <input type="text" name="nim" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Nama</label>
          <input type="text" name="nama" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Jurusan</label>
          <input type="text" name="jurusan" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Simpan</button>
      </form>
    </div>

    <div class="col-md-6 mt-4 mt-md-0">
      <h3 class="mb-4">Data Mahasiswa</h3>
      <div class="card shadow-sm">
        <div class="card-body p-0">
          <table class="table table-bordered table-striped mb-0">
            <thead class="table-primary">
              <tr>
                <th>No</th>
                <th>NIM</th>
                <th>Nama</th>
                <th>Jurusan</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelData">
              <tr><td colspan="5" class="text-center">Memuat data...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function loadData() {
  fetch("backend.php?action=read")
    .then(res => res.json())
    .then(data => {
      let html = '';
      if (data.length > 0) {
        data.forEach((item, i) => {
          html += `<tr>
            <td>${i + 1}</td>
            <td>${item.nim}</td>
            <td>${item.nama}</td>
            <td>${item.jurusan}</td>
            <td><a href="hapus.php?id=${item.id}" onclick="return confirm('Hapus?')" class="btn btn-sm btn-danger">Hapus</a></td>
          </tr>`;
        });
      } else {
        html = '<tr><td colspan="5" class="text-center">Belum ada data</td></tr>';
      }
      document.getElementById("tabelData").innerHTML = html;
    });
}

document.getElementById("formData").addEventListener("submit", function(e) {
  e.preventDefault();
  const form = new FormData(this);
  fetch("backend.php?action=create", {
    method: "POST",
    body: form
  }).then(() => {
    this.reset();
    loadData();
  });
});

loadData();
</script>
</body>
</html>
